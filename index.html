<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Performance Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- Light Theme Variables --- */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-color: #dee2e6;
            --card-bg: #ffffff;
            --header-gradient: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            --success-gradient: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            --danger-gradient: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            --warning-gradient: linear-gradient(135deg, #f8961e 0%, #f94144 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f8ff;
            margin: 0;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header & Control Panel --- */
        header {
            background: var(--header-gradient);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 0 0 12px 12px;
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .user-info {
            font-size: 0.9rem;
            background-color: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 20px;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            margin-left: 15px;
            font-size: 0.85rem;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background-color: #4cc9f0;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        #control-panel {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--dark-color);
        }

        select, input[type="text"], input[type="number"] {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        /* --- Buttons --- */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn-primary { 
            background: var(--header-gradient); 
            color: white; 
        }
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-success { 
            background: var(--success-gradient); 
            color: white; 
        }
        .btn-success:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-danger { 
            background: var(--danger-gradient); 
            color: white; 
        }
        .btn-danger:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-secondary { 
            background-color: var(--secondary-color); 
            color: white; 
        }
        .btn-secondary:hover { 
            background-color: #2d3561;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* --- Display Area --- */
        #display-area {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            min-height: 500px;
        }

        /* --- KPI Cards --- */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }

        .kpi-card.updated::before {
            transform: scaleX(1);
        }

        .kpi-card h3 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary-color);
            transition: all 0.5s ease;
        }

        .kpi-value.updating {
            transform: scale(1.1);
            color: var(--success-color);
        }

        .kpi-change {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .kpi-change.positive {
            color: var(--success-color);
        }

        .kpi-change.negative {
            color: var(--danger-color);
        }

        .kpi-change.neutral {
            color: var(--warning-color);
        }

        /* --- Live Activity Feed --- */
        .activity-feed {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-feed h3 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1.3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .activity-icon.sales {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success-color);
        }

        .activity-icon.branch {
            background-color: rgba(67, 97, 238, 0.2);
            color: var(--primary-color);
        }

        .activity-icon.channel {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger-color);
        }

        .activity-content {
            flex-grow: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #888;
        }

        /* --- Notifications --- */
        .notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            max-width: 350px;
        }

        .notification {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
            animation: slideInRight 0.5s ease;
            display: flex;
            align-items: center;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.danger {
            border-left-color: var(--danger-color);
        }

        .notification-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .notification-content {
            flex-grow: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: #555;
        }

        .notification-close {
            margin-left: 10px;
            cursor: pointer;
            color: #888;
        }

        /* --- Progress Bar --- */
        .progress-container {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            height: 10px;
            border-radius: 10px;
            background: var(--success-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- Last Updated --- */
        .last-updated {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
            margin-top: 10px;
        }

        /* --- Table Styling --- */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
            position: sticky;
            top: 0;
        }

        .data-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .data-table tbody tr:hover {
            background-color: #eef5ff;
        }
        
        .action-btns a { 
            margin-right: 5px;
            text-decoration: none;
        }

        /* --- Report Styling --- */
        .report-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .report-card {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .report-card h3 {
            background: var(--header-gradient);
            color: white;
            margin: 0;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .report-card table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-card th, .report-card td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }
        
        .report-card th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        /* --- Branch Cards --- */
        .branch-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .branch-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-top: 5px solid var(--primary-color);
            transition: all 0.3s;
        }

        .branch-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .branch-card h4 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1.3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .branch-metrics {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--secondary-color);
            text-transform: uppercase;
        }

        .branch-insight {
            background-color: var(--light-color);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        /* --- Modal Styling --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--danger-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            box-sizing: border-box;
        }
        
        .form-actions {
            text-align: right;
            margin-top: 25px;
        }

        /* --- Summary Section --- */
        .summary-section {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .summary-section h2 {
            color: var(--dark-color);
            margin-top: 0;
            font-size: 1.6rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .summary-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .summary-card h3 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.2rem;
        }

        .trend-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .trend-up {
            background-color: var(--success-color);
        }

        .trend-down {
            background-color: var(--danger-color);
        }

        .trend-neutral {
            background-color: var(--warning-color);
        }

        /* --- Key Patterns Section --- */
        .patterns-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .patterns-section h2 {
            color: var(--dark-color);
            margin-top: 0;
            font-size: 1.6rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .pattern-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--light-color);
        }

        .pattern-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            color: var(--primary-color);
        }

        .pattern-content h3 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .pattern-content p {
            margin-bottom: 0;
            color: #555;
        }

        /* --- Chart Containers --- */
        .chart-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .chart-container h3 {
            color: var(--dark-color);
            margin-top: 0;
            font-size: 1.3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }

        /* --- Tabs --- */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: var(--secondary-color);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .kpi-container {
                grid-template-columns: 1fr;
            }
            
            .branch-cards {
                grid-template-columns: 1fr;
            }
            
            .summary-content {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            header h1 {
                margin-bottom: 10px;
            }
            
            .chart-wrapper {
                height: 250px;
            }
            
            .notifications {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>Sales Performance Management System</h1>
            <div class="live-indicator">
                <span class="live-dot"></span>
                <span>Live</span>
            </div>
        </div>
        <div class="user-info">
            <span id="current-time"></span> | Admin User
        </div>
    </header>

    <main class="container">
        <section id="control-panel">
            <div class="filter-group">
                <label for="branch-filter">Branch:</label>
                <select id="branch-filter">
                    <option value="all">All Branches</option>
                    <option value="Hamdan St">Hamdan St</option>
                    <option value="Khaldia">Khaldia</option>
                    <option value="Shabiya 11">Shabiya 11</option>
                    <option value="Muroor">Muroor</option>
                    <option value="Al Barsha">Al Barsha</option>
                    <option value="Al Satwa">Al Satwa</option>
                    <option value="Elctria">Elctria</option>
                    <option value="Al Rigga">Al Rigga</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="month-filter">Month:</label>
                <select id="month-filter">
                    <option value="all">All Months</option>
                    <option value="Jan">January</option>
                    <option value="Feb">February</option>
                    <option value="Mar">March</option>
                    <option value="Apr">April</option>
                    <option value="May">May</option>
                    <option value="Jun">June</option>
                    <option value="Jul">July</option>
                    <option value="Aug">August</option>
                    <option value="Sep">September</option>
                    <option value="Oct">October</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="renderDashboard()">Dashboard</button>
            <button class="btn btn-secondary" onclick="renderChannelPerformance()">Channel Analysis</button>
            <button class="btn btn-secondary" onclick="renderBranchPerformance()">Branch Analysis</button>
            <button class="btn btn-secondary" onclick="renderTrendAnalysis()">Trend Analysis</button>
            <button class="btn btn-success" onclick="showAddForm()">+ Add Record</button>
        </section>

        <section id="display-area">
            <!-- Dynamic content will be loaded here -->
            <p style="text-align: center; color: #888; padding: 50px;">Please select a view from the control panel above.</p>
        </section>
    </main>

    <!-- Notifications Container -->
    <div class="notifications" id="notifications"></div>

    <!-- Add Record Modal -->
    <div id="add-record-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModals()">&times;</span>
            <h2>Add New Record</h2>
            <form id="add-form">
                <div class="form-group"><label for="add-month">Month</label><select id="add-month" required><option value="Jan">Jan</option><option value="Feb">Feb</option><option value="Mar">Mar</option><option value="Apr">Apr</option><option value="May">May</option><option value="Jun">Jun</option><option value="Jul">Jul</option><option value="Aug">Aug</option><option value="Sep">Sep</option><option value="Oct">Oct</option></select></div>
                <div class="form-group"><label for="add-branch">Branch</label><select id="add-branch" required><option value="Hamdan St">Hamdan St</option><option value="Khaldia">Khaldia</option><option value="Shabiya 11">Shabiya 11</option><option value="Muroor">Muroor</option><option value="Al Barsha">Al Barsha</option><option value="Al Satwa">Al Satwa</option><option value="Elctria">Elctria</option><option value="Al Rigga">Al Rigga</option></select></div>
                <div class="form-group"><label for="add-channel">Channel</label><select id="add-channel" required><option value="Dining Takeaway">Dining Takeaway</option><option value="Self Delivery">Self Delivery</option><option value="Online Web">Online Web</option><option value="NOON">NOON</option><option value="Careem">Careem</option><option value="Smile">Smile</option><option value="Deliveroo">Deliveroo</option><option value="Keeta">Keeta</option><option value="Talabat">Talabat</option><option value="Talabana">Talabana</option></select></div>
                <div class="form-group"><label for="add-sales-2024">Sales 2024</label><input type="number" id="add-sales-2024" required></div>
                <div class="form-group"><label for="add-sales-2025">Sales 2025</label><input type="number" id="add-sales-2025" required></div>
                <div class="form-group"><label for="add-orders-2024">Orders 2024</label><input type="number" id="add-orders-2024" required></div>
                <div class="form-group"><label for="add-orders-2025">Orders 2025</label><input type="number" id="add-orders-2025" required></div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideModals()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Record</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Record Modal -->
    <div id="edit-record-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModals()">&times;</span>
            <h2>Edit Record</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-group"><label for="edit-month">Month</label><select id="edit-month" required><option value="Jan">Jan</option><option value="Feb">Feb</option><option value="Mar">Mar</option><option value="Apr">Apr</option><option value="May">May</option><option value="Jun">Jun</option><option value="Jul">Jul</option><option value="Aug">Aug</option><option value="Sep">Sep</option><option value="Oct">Oct</option></select></div>
                <div class="form-group"><label for="edit-branch">Branch</label><select id="edit-branch" required><option value="Hamdan St">Hamdan St</option><option value="Khaldia">Khaldia</option><option value="Shabiya 11">Shabiya 11</option><option value="Muroor">Muroor</option><option value="Al Barsha">Al Barsha</option><option value="Al Satwa">Al Satwa</option><option value="Elctria">Elctria</option><option value="Al Rigga">Al Rigga</option></select></div>
                <div class="form-group"><label for="edit-channel">Channel</label><select id="edit-channel" required><option value="Dining Takeaway">Dining Takeaway</option><option value="Self Delivery">Self Delivery</option><option value="Online Web">Online Web</option><option value="NOON">NOON</option><option value="Careem">Careem</option><option value="Smile">Smile</option><option value="Deliveroo">Deliveroo</option><option value="Keeta">Keeta</option><option value="Talabat">Talabat</option><option value="Talabana">Talabana</option></select></div>
                <div class="form-group"><label for="edit-sales-2024">Sales 2024</label><input type="number" id="edit-sales-2024" required></div>
                <div class="form-group"><label for="edit-sales-2025">Sales 2025</label><input type="number" id="edit-sales-2025" required></div>
                <div class="form-group"><label for="edit-orders-2024">Orders 2024</label><input type="number" id="edit-orders-2024" required></div>
                <div class="form-group"><label for="edit-orders-2025">Orders 2025</label><input type="number" id="edit-orders-2025" required></div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideModals()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Record</button>
                </div>
            </form>
        </div>
    </div>

<script>
    // --- TRUE DATA ---
    // Channel Performance Data
    const channelData = [
        { channel: 'Careem', sales2025: 4447023.88, sales2024: 950012 },
        { channel: 'Deliveroo', sales2025: 310045.40, sales2024: 367162 },
        { channel: 'Dining Takeaway', sales2025: 22762541, sales2024: 18532229 },
        { channel: 'Keeta', sales2025: 771013.10, sales2024: 0 },
        { channel: 'NOON', sales2025: 6615356.05, sales2024: 4478670 },
        { channel: 'Online Web', sales2025: 874256, sales2024: 912564 },
        { channel: 'Self Delivery', sales2025: 3401506, sales2024: 3806008 },
        { channel: 'Smile', sales2025: 2076596, sales2024: 1766060 },
        { channel: 'Talabana', sales2025: 202.59, sales2024: 57578 },
        { channel: 'Talabat', sales2025: 3455930, sales2024: 4135900 }
    ];

    // Branch Performance Data
    const branchData = [
        { branch: 'Hamdan St', sales2025: 7444537, sales2024: 8297881 },
        { branch: 'Khaldia', sales2025: 6039662, sales2024: 6293740 },
        { branch: 'Shabiya 11', sales2025: 6510384, sales2024: 5502957 },
        { branch: 'Muroor', sales2025: 5125737, sales2024: 4767127 },
        { branch: 'Al Barsha', sales2025: 6257407, sales2024: 5753883 },
        { branch: 'Al Satwa', sales2025: 4774601, sales2024: 2631356 },
        { branch: 'Elctria', sales2025: 7637929, sales2024: 2830175 },
        { branch: 'Al Rigga', sales2025: 442475, sales2024: 0 }
    ];

    // Monthly Sales Data
    const monthlyData = [
        { month: 'Jan', sales2024: 3182734, sales2025: 4282615 },
        { month: 'Feb', sales2024: 2979705, sales2025: 4204879 },
        { month: 'Mar', sales2024: 2642939, sales2025: 3268370 },
        { month: 'Apr', sales2024: 3132765, sales2025: 4194001 },
        { month: 'May', sales2024: 3544916, sales2025: 4556281 },
        { month: 'Jun', sales2024: 3953553, sales2025: 4749491 },
        { month: 'Jul', sales2024: 3694207, sales2025: 4837609 },
        { month: 'Aug', sales2024: 3797457, sales2025: 4558857 },
        { month: 'Sep', sales2024: 3812853, sales2025: 4516801 },
        { month: 'Oct', sales2024: 4265054, sales2025: 5853265 }
    ];

    // --- DATA & STATE ---
    let salesData = [
        // Sample data - in a real system this would be populated from a database
        { id: 1, month: 'Jan', branch: 'Hamdan St', channel: 'Dining Takeaway', sales2024: 424761, sales2025: 411426, orders2024: 17141, orders2025: 17299 },
        { id: 2, month: 'Jan', branch: 'Hamdan St', channel: 'Self Delivery', sales2024: 130332, sales2025: 119300, orders2024: 2797, orders2025: 2757 },
        { id: 3, month: 'Jan', branch: 'Hamdan St', channel: 'Online Web', sales2024: 39204, sales2025: 25546, orders2024: 771, orders2025: 569 },
        { id: 4, month: 'Jan', branch: 'Hamdan St', channel: 'NOON', sales2024: 146815, sales2025: 79328, orders2024: 3833, orders2025: 2238 },
        { id: 5, month: 'Jan', branch: 'Hamdan St', channel: 'Careem', sales2024: 83, sales2025: 38266, orders2024: 8, orders2025: 1167 },
        { id: 6, month: 'Jan', branch: 'Hamdan St', channel: 'Smile', sales2024: 31665, sales2025: 50561, orders2024: 940, orders2025: 1498 },
        { id: 7, month: 'Jan', branch: 'Hamdan St', channel: 'Deliveroo', sales2024: 7096, sales2025: 5483, orders2024: 144, orders2025: 97 },
        { id: 8, month: 'Jan', branch: 'Hamdan St', channel: 'Keeta', sales2024: 0, sales2025: 0, orders2024: 0, orders2025: 0 },
        { id: 9, month: 'Jan', branch: 'Hamdan St', channel: 'Talabat', sales2024: 112159, sales2025: 55273, orders2024: 2248, orders2025: 1144 },
        { id: 10, month: 'Jan', branch: 'Hamdan St', channel: 'Talabana', sales2024: 636, sales2025: 0, orders2024: 31, orders2025: 0 },
        { id: 11, month: 'Oct', branch: 'Al Barsha', channel: 'Keeta', sales2024: 0, sales2025: 167922, orders2024: 0, orders2025: 3337 },
        { id: 12, month: 'Oct', branch: 'Al Rigga', channel: 'Keeta', sales2024: 0, sales2025: 282732, orders2024: 0, orders2025: 5827 },
    ];
    
    let nextId = salesData.length > 0 ? Math.max(...salesData.map(d => d.id)) + 1 : 1;
    let currentView = null;
    let charts = {};
    let updateInterval = null;
    let lastUpdateTime = new Date();

    // --- DOM ELEMENT REFERENCES ---
    const displayArea = document.getElementById('display-area');
    const branchFilter = document.getElementById('branch-filter');
    const monthFilter = document.getElementById('month-filter');
    const addModal = document.getElementById('add-record-modal');
    const editModal = document.getElementById('edit-record-modal');
    const addForm = document.getElementById('add-form');
    const editForm = document.getElementById('edit-form');
    const notificationsContainer = document.getElementById('notifications');

    // --- EVENT LISTENERS ---
    branchFilter.addEventListener('change', () => { 
        if(currentView === 'table') renderDetailedTable(); 
        else if(currentView === 'summary') renderDashboard(); 
        else if(currentView === 'channel') renderChannelPerformance();
        else if(currentView === 'branch') renderBranchPerformance();
        else if(currentView === 'trend') renderTrendAnalysis();
    });
    
    monthFilter.addEventListener('change', () => { 
        if(currentView === 'table') renderDetailedTable(); 
        else if(currentView === 'summary') renderDashboard(); 
        else if(currentView === 'channel') renderChannelPerformance();
        else if(currentView === 'branch') renderBranchPerformance();
        else if(currentView === 'trend') renderTrendAnalysis();
    });
    
    addForm.addEventListener('submit', handleAddRecord);
    editForm.addEventListener('submit', handleUpdateRecord);

    // --- REAL-TIME UPDATES ---
    function startRealTimeUpdates() {
        // Update current time every second
        updateTime();
        setInterval(updateTime, 1000);
        
        // Update dashboard data every 30 seconds
        updateInterval = setInterval(() => {
            if (currentView === 'summary') {
                updateDashboardData();
            }
        }, 30000);
        
        // Simulate live activities
        setInterval(simulateActivity, 8000);
    }

    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        document.getElementById('current-time').textContent = timeString;
    }

    function updateDashboardData() {
        // Show progress bar
        const progressContainer = document.querySelector('.progress-container');
        const progressBar = document.querySelector('.progress-bar');
        if (progressContainer) {
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            // Simulate loading progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        
                        // Update KPI values with animation
                        animateKPIUpdates();
                        
                        // Update last updated time
                        lastUpdateTime = new Date();
                        const lastUpdatedElement = document.querySelector('.last-updated');
                        if (lastUpdatedElement) {
                            lastUpdatedElement.textContent = `Last updated: ${lastUpdateTime.toLocaleTimeString()}`;
                        }
                        
                        // Show notification
                        showNotification('Data Updated', 'Dashboard data has been refreshed', 'success');
                    }, 500);
                }
            }, 100);
        }
    }

    function animateKPIUpdates() {
        // Add animation class to KPI cards
        const kpiCards = document.querySelectorAll('.kpi-card');
        kpiCards.forEach(card => {
            card.classList.add('updated');
            const valueElement = card.querySelector('.kpi-value');
            if (valueElement) {
                valueElement.classList.add('updating');
                setTimeout(() => {
                    valueElement.classList.remove('updating');
                }, 1000);
            }
            setTimeout(() => {
                card.classList.remove('updated');
            }, 2000);
        });
    }

    function simulateActivity() {
        if (currentView !== 'summary') return;
        
        const activities = [
            { type: 'sales', title: 'New order received', message: 'Careem - Al Satwa branch' },
            { type: 'branch', title: 'Branch milestone', message: 'Elctria reached $7.5M in sales' },
            { type: 'channel', title: 'Channel growth', message: 'NOON sales increased by 5%' },
            { type: 'sales', title: 'Large order', message: 'Dining Takeaway - $1,200 order' },
            { type: 'branch', title: 'Branch performance', message: 'Al Satwa showing strong growth' }
        ];
        
        const randomActivity = activities[Math.floor(Math.random() * activities.length)];
        addActivityToFeed(randomActivity);
    }

    function addActivityToFeed(activity) {
        const activityFeed = document.querySelector('.activity-feed');
        if (!activityFeed) return;
        
        const activityItem = document.createElement('div');
        activityItem.className = 'activity-item';
        
        const iconClass = activity.type === 'sales' ? 'sales' : 
                          activity.type === 'branch' ? 'branch' : 'channel';
        const icon = activity.type === 'sales' ? 'üí∞' : 
                     activity.type === 'branch' ? 'üè¢' : 'üì±';
        
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        
        activityItem.innerHTML = `
            <div class="activity-icon ${iconClass}">${icon}</div>
            <div class="activity-content">
                <div class="activity-title">${activity.title}</div>
                <div>${activity.message}</div>
                <div class="activity-time">${timeString}</div>
            </div>
        `;
        
        // Add to top of feed
        const feedContent = activityFeed.querySelector('.activity-feed-content');
        if (feedContent) {
            feedContent.insertBefore(activityItem, feedContent.firstChild);
            
            // Remove oldest items if more than 10
            const items = feedContent.querySelectorAll('.activity-item');
            if (items.length > 10) {
                feedContent.removeChild(items[items.length - 1]);
            }
        }
    }

    function showNotification(title, message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icon = type === 'success' ? '‚úì' : 
                     type === 'warning' ? '‚ö†' : 
                     type === 'danger' ? '‚úï' : '‚Ñπ';
        
        notification.innerHTML = `
            <div class="notification-icon">${icon}</div>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
            <div class="notification-close" onclick="this.parentElement.remove()">‚úï</div>
        `;
        
        notificationsContainer.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }

    // --- HELPER FUNCTIONS ---
    function formatNumber(num) {
        return new Intl.NumberFormat('en-US').format(num);
    }
    
    function formatCurrency(num) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(num);
    }
    
    function calculateGrowth(current, previous) {
        if (previous === 0) return current > 0 ? 'New' : '0%';
        const growth = ((current - previous) / previous * 100).toFixed(2);
        return `${growth > 0 ? '+' : ''}${growth}%`;
    }
    
    function getGrowthClass(growth) {
        if (growth === 'New') return 'positive';
        const value = parseFloat(growth.replace('%', ''));
        if (value > 0) return 'positive';
        if (value < 0) return 'negative';
        return 'neutral';
    }
    
    function getFilteredData() {
        const branchValue = branchFilter.value;
        const monthValue = monthFilter.value;
        return salesData.filter(item => {
            const branchMatch = branchValue === 'all' || item.branch === branchValue;
            const monthMatch = monthValue === 'all' || item.month === monthValue;
            return branchMatch && monthMatch;
        });
    }

    function hideModals() {
        addModal.style.display = 'none';
        editModal.style.display = 'none';
    }

    function destroyCharts() {
        Object.values(charts).forEach(chart => {
            if (chart) chart.destroy();
        });
        charts = {};
    }

    // --- CHART CREATION FUNCTIONS ---
    function createMonthlyTrendChart() {
        const ctx = document.getElementById('monthly-trend-chart').getContext('2d');
        charts.monthlyTrend = new Chart(ctx, {
            type: 'line',
            data: {
                labels: monthlyData.map(item => item.month),
                datasets: [
                    {
                        label: '2024 Sales',
                        data: monthlyData.map(item => item.sales2024),
                        borderColor: '#3f37c9',
                        backgroundColor: 'rgba(63, 55, 201, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: '2025 Sales',
                        data: monthlyData.map(item => item.sales2025),
                        borderColor: '#4cc9f0',
                        backgroundColor: 'rgba(76, 201, 240, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + formatCurrency(context.raw);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value / 1000000 + 'M';
                            }
                        }
                    }
                }
            }
        });
    }

    function createChannelComparisonChart() {
        const ctx = document.getElementById('channel-comparison-chart').getContext('2d');
        const channels = channelData.map(item => item.channel);
        const sales2024 = channelData.map(item => item.sales2024);
        const sales2025 = channelData.map(item => item.sales2025);
        
        charts.channelComparison = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: channels,
                datasets: [
                    {
                        label: '2024 Sales',
                        data: sales2024,
                        backgroundColor: '#3f37c9',
                        borderColor: '#3f37c9',
                        borderWidth: 1
                    },
                    {
                        label: '2025 Sales',
                        data: sales2025,
                        backgroundColor: '#4cc9f0',
                        borderColor: '#4cc9f0',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + formatCurrency(context.raw);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value / 1000000 + 'M';
                            }
                        }
                    }
                }
            }
        });
    }

    function createBranchPerformanceChart() {
        const ctx = document.getElementById('branch-performance-chart').getContext('2d');
        const branches = branchData.map(item => item.branch);
        const growth = branchData.map(item => {
            if (item.sales2024 === 0) return 100;
            return ((item.sales2025 - item.sales2024) / item.sales2024 * 100).toFixed(2);
        });
        
        const backgroundColors = growth.map(value => {
            if (value > 20) return '#4cc9f0';
            if (value > 0) return '#4cc9f0';
            if (value === 100) return '#4cc9f0';
            return '#f72585';
        });
        
        charts.branchPerformance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: branches,
                datasets: [
                    {
                        label: 'Growth %',
                        data: growth,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors,
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Growth: ' + context.raw + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }

    function createChannelPieChart() {
        const ctx = document.getElementById('channel-pie-chart').getContext('2d');
        const channels = channelData.map(item => item.channel);
        const sales = channelData.map(item => item.sales2025);
        
        charts.channelPie = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: channels,
                datasets: [{
                    data: sales,
                    backgroundColor: [
                        '#4361ee',
                        '#3f37c9',
                        '#4cc9f0',
                        '#4361ee',
                        '#3f37c9',
                        '#4cc9f0',
                        '#f72585',
                        '#f8961e',
                        '#f94144',
                        '#f72585'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = formatCurrency(context.raw);
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.raw / total) * 100).toFixed(1);
                                return label + ': ' + value + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
    }

    // --- CORE RENDER FUNCTIONS ---
    function renderDashboard() {
        currentView = 'summary';
        destroyCharts();
        
        // Clear any existing update interval
        if (updateInterval) {
            clearInterval(updateInterval);
        }
        
        // Calculate KPIs
        const total2024 = channelData.reduce((sum, item) => sum + item.sales2024, 0);
        const total2025 = channelData.reduce((sum, item) => sum + item.sales2025, 0);
        const growth = calculateGrowth(total2025, total2024);
        
        // Calculate delivery percentage
        const deliveryChannels = ['Careem', 'Deliveroo', 'Keeta', 'NOON', 'Talabat', 'Talabana', 'Self Delivery'];
        const delivery2024 = channelData
            .filter(item => deliveryChannels.includes(item.channel))
            .reduce((sum, item) => sum + item.sales2024, 0);
        const delivery2025 = channelData
            .filter(item => deliveryChannels.includes(item.channel))
            .reduce((sum, item) => sum + item.sales2025, 0);
        const deliveryPercentage2024 = total2024 > 0 ? (delivery2024 / total2024 * 100).toFixed(1) : 0;
        const deliveryPercentage2025 = total2025 > 0 ? (delivery2025 / total2025 * 100).toFixed(1) : 0;
        
        // Calculate online percentage
        const onlineChannels = ['Online Web', 'NOON', 'Careem', 'Deliveroo', 'Keeta'];
        const online2024 = channelData
            .filter(item => onlineChannels.includes(item.channel))
            .reduce((sum, item) => sum + item.sales2024, 0);
        const online2025 = channelData
            .filter(item => onlineChannels.includes(item.channel))
            .reduce((sum, item) => sum + item.sales2025, 0);
        const onlinePercentage2024 = total2024 > 0 ? (online2024 / total2024 * 100).toFixed(1) : 0;
        const onlinePercentage2025 = total2025 > 0 ? (online2025 / total2025 * 100).toFixed(1) : 0;
        
        // Calculate branch growth
        const branchGrowth = calculateGrowth(
            branchData.reduce((sum, item) => sum + item.sales2025, 0),
            branchData.reduce((sum, item) => sum + item.sales2024, 0)
        );
        
        // Calculate average order value
        const totalOrders2024 = salesData.reduce((sum, item) => sum + item.orders2024, 0);
        const totalOrders2025 = salesData.reduce((sum, item) => sum + item.orders2025, 0);
        const avgOrder2024 = totalOrders2024 > 0 ? total2024 / totalOrders2024 : 0;
        const avgOrder2025 = totalOrders2025 > 0 ? total2025 / totalOrders2025 : 0;
        const avgOrderGrowth = calculateGrowth(avgOrder2025, avgOrder2024);
        
        let html = `
            <div class="kpi-container">
                <div class="kpi-card">
                    <h3>Total Sales 2025</h3>
                    <div class="kpi-value">${formatCurrency(total2025)}</div>
                    <div class="kpi-change ${getGrowthClass(growth)}">
                        ${growth === 'New' ? 'New' : growth} vs 2024
                    </div>
                </div>
                <div class="kpi-card">
                    <h3>Total Sales 2024</h3>
                    <div class="kpi-value">${formatCurrency(total2024)}</div>
                    <div class="kpi-change neutral">Previous Year</div>
                </div>
                <div class="kpi-card">
                    <h3>Delivery Percentage</h3>
                    <div class="kpi-value">${deliveryPercentage2025}%</div>
                    <div class="kpi-change ${deliveryPercentage2025 > deliveryPercentage2024 ? 'positive' : 'negative'}">
                        ${deliveryPercentage2024}% in 2024
                    </div>
                </div>
                <div class="kpi-card">
                    <h3>Online Percentage</h3>
                    <div class="kpi-value">${onlinePercentage2025}%</div>
                    <div class="kpi-change ${onlinePercentage2025 > onlinePercentage2024 ? 'positive' : 'negative'}">
                        ${onlinePercentage2024}% in 2024
                    </div>
                </div>
                <div class="kpi-card">
                    <h3>Average Order Value</h3>
                    <div class="kpi-value">${formatCurrency(avgOrder2025)}</div>
                    <div class="kpi-change ${getGrowthClass(avgOrderGrowth)}">
                        ${avgOrderGrowth === 'New' ? 'New' : avgOrderGrowth}
                    </div>
                </div>
                <div class="kpi-card">
                    <h3>Branch Growth</h3>
                    <div class="kpi-value">${branchGrowth}</div>
                    <div class="kpi-change ${getGrowthClass(branchGrowth)}">
                        Overall Performance
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            
            <div class="last-updated">Last updated: ${lastUpdateTime.toLocaleTimeString()}</div>
            
            <div class="chart-container">
                <h3>Monthly Sales Trend</h3>
                <div class="chart-wrapper">
                    <canvas id="monthly-trend-chart"></canvas>
                </div>
            </div>
            
            <div class="activity-feed">
                <h3>Live Activity Feed</h3>
                <div class="activity-feed-content">
                    <div class="activity-item">
                        <div class="activity-icon sales">üí∞</div>
                        <div class="activity-content">
                            <div class="activity-title">System initialized</div>
                            <div>Dashboard loaded successfully</div>
                            <div class="activity-time">${new Date().toLocaleTimeString()}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="summary-section">
                <h2>Executive Summary</h2>
                <div class="summary-content">
                    <div class="summary-card">
                        <h3>Overall Performance</h3>
                        <p>Total sales grew by <strong>${growth}</strong> in 2025 compared to 2024, with delivery channels accounting for <strong>${deliveryPercentage2025}%</strong> of sales.</p>
                        <p>Online channels represent <strong>${onlinePercentage2025}%</strong> of total sales, showing a clear shift toward digital platforms.</p>
                        <p>Average order value increased by <strong>${avgOrderGrowth}</strong>, indicating customers are spending more per transaction.</p>
                    </div>
                    <div class="summary-card">
                        <h3>Top Performers</h3>
                        <p><strong>Elctria</strong> branch showed exceptional growth with <strong>+169.9%</strong> increase in sales.</p>
                        <p><strong>Careem</strong> channel grew by <strong>+368.1%</strong>, becoming a significant contributor to overall sales.</p>
                        <p><strong>Al Satwa</strong> branch increased sales by <strong>+81.5%</strong>, demonstrating strong market penetration.</p>
                    </div>
                    <div class="summary-card">
                        <h3>Areas of Concern</h3>
                        <p><strong>Hamdan St</strong> branch declined by <strong>-10.3%</strong>, requiring strategic intervention.</p>
                        <p><strong>Talabat</strong> channel decreased by <strong>-16.4%</strong>, losing market share to competitors.</p>
                        <p><strong>Self Delivery</strong> channel declined by <strong>-10.6%</strong>, indicating a shift to third-party delivery services.</p>
                    </div>
                </div>
            </div>
            
            <div class="patterns-section">
                <h2>Key Performance Patterns</h2>
                <div class="pattern-item">
                    <div class="pattern-icon">üìâ</div>
                    <div class="pattern-content">
                        <h3>Self-Delivery Decline</h3>
                        <p>Self-Delivery sales decreased across most branches, with an overall decline of <strong>-10.6%</strong>. This suggests customers are shifting to third-party delivery platforms.</p>
                    </div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-icon">üì±</div>
                    <div class="pattern-content">
                        <h3>Digital Transformation</h3>
                        <p>Online channels (Careem, NOON, Keeta) showed strong growth, with <strong>NOON</strong> increasing by <strong>+47.7%</strong> and <strong>Careem</strong> by <strong>+368.1%</strong>.</p>
                    </div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-icon">üÜï</div>
                    <div class="pattern-content">
                        <h3>New Market Entrants</h3>
                        <p><strong>Keeta</strong> entered the market in 2025, capturing <strong>1.7%</strong> of total sales in just 10 months, showing strong market acceptance.</p>
                    </div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-icon">üìä</div>
                    <div class="pattern-content">
                        <h3>Missing Data Impact</h3>
                        <p>November and December data are missing for both years, which may affect year-over-year comparisons. Projections suggest 2025 could reach <strong>$54.8M</strong> if trends continue.</p>
                    </div>
                </div>
            </div>
        `;
        
        displayArea.innerHTML = html;
        
        // Create charts after DOM is updated
        setTimeout(() => {
            createMonthlyTrendChart();
            startRealTimeUpdates();
        }, 100);
    }

    function renderChannelPerformance() {
        currentView = 'channel';
        destroyCharts();
        
        // Clear update interval when not on dashboard
        if (updateInterval) {
            clearInterval(updateInterval);
            updateInterval = null;
        }
        
        let html = `
            <h2>Channel Performance Analysis</h2>
            
            <div class="chart-container">
                <h3>Channel Sales Comparison</h3>
                <div class="chart-wrapper">
                    <canvas id="channel-comparison-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Channel Market Share (2025)</h3>
                <div class="chart-wrapper">
                    <canvas id="channel-pie-chart"></canvas>
                </div>
            </div>
            
            <div class="report-container">
                <div class="report-card">
                    <h3>Channel Sales Details</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Channel</th>
                                <th>Sales 2024</th>
                                <th>Sales 2025</th>
                                <th>Growth %</th>
                                <th>Market Share 2024</th>
                                <th>Market Share 2025</th>
                                <th>Share Change</th>
                            </tr>
                        </thead>
                        <tbody>
        `;
        
        const total2024 = channelData.reduce((sum, item) => sum + item.sales2024, 0);
        const total2025 = channelData.reduce((sum, item) => sum + item.sales2025, 0);
        
        channelData.forEach(item => {
            const growth = calculateGrowth(item.sales2025, item.sales2024);
            const growthClass = getGrowthClass(growth);
            const share2024 = total2024 > 0 ? (item.sales2024 / total2024 * 100).toFixed(1) : 0;
            const share2025 = total2025 > 0 ? (item.sales2025 / total2025 * 100).toFixed(1) : 0;
            const shareChange = (share2025 - share2024).toFixed(1);
            const changeClass = shareChange > 0 ? 'positive' : shareChange < 0 ? 'negative' : 'neutral';
            
            html += `
                <tr>
                    <td><strong>${item.channel}</strong></td>
                    <td>${formatCurrency(item.sales2024)}</td>
                    <td>${formatCurrency(item.sales2025)}</td>
                    <td class="${growthClass}"><strong>${growth}</strong></td>
                    <td>${share2024}%</td>
                    <td>${share2025}%</td>
                    <td class="${changeClass}">${shareChange > 0 ? '+' : ''}${shareChange}%</td>
                </tr>
            `;
        });
        
        html += `
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        
        displayArea.innerHTML = html;
        
        // Create charts after DOM is updated
        setTimeout(() => {
            createChannelComparisonChart();
            createChannelPieChart();
        }, 100);
    }

    function renderBranchPerformance() {
        currentView = 'branch';
        destroyCharts();
        
        // Clear update interval when not on dashboard
        if (updateInterval) {
            clearInterval(updateInterval);
            updateInterval = null;
        }
        
        let html = `
            <h2>Branch Performance Analysis</h2>
            
            <div class="chart-container">
                <h3>Branch Growth Comparison</h3>
                <div class="chart-wrapper">
                    <canvas id="branch-performance-chart"></canvas>
                </div>
            </div>
            
            <div class="report-container">
                <div class="report-card">
                    <h3>Branch Sales Comparison</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Branch</th>
                                <th>Sales 2024</th>
                                <th>Sales 2025</th>
                                <th>Growth %</th>
                                <th>Contribution 2025</th>
                                <th>Performance</th>
                            </tr>
                        </thead>
                        <tbody>
        `;
        
        const total2024 = branchData.reduce((sum, item) => sum + item.sales2024, 0);
        const total2025 = branchData.reduce((sum, item) => sum + item.sales2025, 0);
        
        branchData.forEach(item => {
            const growth = calculateGrowth(item.sales2025, item.sales2024);
            const growthClass = getGrowthClass(growth);
            const contribution = total2025 > 0 ? (item.sales2025 / total2025 * 100).toFixed(1) : 0;
            
            let performance = "";
            if (growthClass === 'positive') {
                if (parseFloat(growth) > 50) performance = "Exceptional";
                else if (parseFloat(growth) > 20) performance = "Strong";
                else performance = "Good";
            } else if (growthClass === 'negative') {
                if (parseFloat(growth) < -20) performance = "Critical";
                else performance = "Declining";
            } else {
                performance = "Stable";
            }
            
            html += `
                <tr>
                    <td><strong>${item.branch}</strong></td>
                    <td>${formatCurrency(item.sales2024)}</td>
                    <td>${formatCurrency(item.sales2025)}</td>
                    <td class="${growthClass}"><strong>${growth}</strong></td>
                    <td>${contribution}%</td>
                    <td>${performance}</td>
                </tr>
            `;
        });
        
        html += `
                        </tbody>
                    </table>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Branch-by-Branch Analysis</h3>
            <div class="branch-cards">
        `;
        
        branchData.forEach(item => {
            const growth = calculateGrowth(item.sales2025, item.sales2024);
            const growthClass = getGrowthClass(growth);
            
            // Calculate Self-Delivery and Online Web performance for this branch
            const branchSalesData = salesData.filter(d => d.branch === item.branch);
            const selfDelivery2024 = branchSalesData
                .filter(d => d.channel === 'Self Delivery')
                .reduce((sum, d) => sum + d.sales2024, 0);
            const selfDelivery2025 = branchSalesData
                .filter(d => d.channel === 'Self Delivery')
                .reduce((sum, d) => sum + d.sales2025, 0);
            const selfDeliveryGrowth = calculateGrowth(selfDelivery2025, selfDelivery2024);
            
            const onlineWeb2024 = branchSalesData
                .filter(d => d.channel === 'Online Web')
                .reduce((sum, d) => sum + d.sales2024, 0);
            const onlineWeb2025 = branchSalesData
                .filter(d => d.channel === 'Online Web')
                .reduce((sum, d) => sum + d.sales2025, 0);
            const onlineWebGrowth = calculateGrowth(onlineWeb2025, onlineWeb2024);
            
            // Generate insight based on performance
            let insight = "";
            if (growthClass === 'positive') {
                if (parseFloat(growth) > 50) {
                    insight = `Exceptional performance with ${growth} growth. This branch is a key driver of overall success. Consider expanding successful strategies to other branches.`;
                } else {
                    insight = `Strong performance with ${growth} growth. Continue current strategies and explore opportunities for further expansion.`;
                }
            } else if (growthClass === 'negative') {
                insight = `Declining sales of ${growth}. Requires immediate attention and strategic review. Analyze customer feedback and competitor activities.`;
            } else {
                insight = `Stable performance with minimal change. Focus on optimization and efficiency improvements to drive growth.`;
            }
            
            html += `
                <div class="branch-card">
                    <h4>${item.branch}</h4>
                    <div class="branch-metrics">
                        <div class="metric">
                            <div class="metric-value">${formatCurrency(item.sales2025)}</div>
                            <div class="metric-label">2025 Sales</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${formatCurrency(item.sales2024)}</div>
                            <div class="metric-label">2024 Sales</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value ${growthClass}">${growth}</div>
                            <div class="metric-label">Growth</div>
                        </div>
                    </div>
                    
                    <div class="branch-metrics">
                        <div class="metric">
                            <div class="metric-value">${selfDeliveryGrowth}</div>
                            <div class="metric-label">Self-Delivery</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${onlineWebGrowth}</div>
                            <div class="metric-label">Online Web</div>
                        </div>
                    </div>
                    
                    <div class="branch-insight">
                        <strong>Insight:</strong> ${insight}
                    </div>
                </div>
            `;
        });
        
        html += `
            </div>
        `;
        
        displayArea.innerHTML = html;
        
        // Create charts after DOM is updated
        setTimeout(() => {
            createBranchPerformanceChart();
        }, 100);
    }

    function renderTrendAnalysis() {
        currentView = 'trend';
        destroyCharts();
        
        // Clear update interval when not on dashboard
        if (updateInterval) {
            clearInterval(updateInterval);
            updateInterval = null;
        }
        
        let html = `
            <h2>Trend Analysis</h2>
            
            <div class="tabs">
                <div class="tab active" onclick="openTab(event, 'monthly-trends')">Monthly Trends</div>
                <div class="tab" onclick="openTab(event, 'channel-trends')">Channel Trends</div>
                <div class="tab" onclick="openTab(event, 'branch-trends')">Branch Trends</div>
            </div>
            
            <div id="monthly-trends" class="tab-content active">
                <div class="chart-container">
                    <h3>Monthly Sales Trend</h3>
                    <div class="chart-wrapper">
                        <canvas id="monthly-trend-chart"></canvas>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h2>Monthly Trend Analysis</h2>
                    <div class="summary-content">
                        <div class="summary-card">
                            <h3>Key Observations</h3>
                            <ul>
                                <li>October 2025 shows the highest sales at <strong>$5.85M</strong>, a 37% increase over the best 2024 month.</li>
                                <li>Consistent growth trend throughout 2025 with only minor fluctuations.</li>
                                <li>The gap between 2024 and 2025 sales widens as the year progresses.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Seasonal Patterns</h3>
                            <ul>
                                <li>Both years show a dip in March, possibly due to seasonal factors.</li>
                                <li>Summer months (June-August) show strong performance in 2025.</li>
                                <li>Q4 shows accelerated growth in 2025, indicating strong year-end momentum.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Projections</h3>
                            <ul>
                                <li>If current trends continue, 2025 total sales could reach <strong>$54.8M</strong>.</li>
                                <li>November and December 2025 are projected to outperform 2024 by 25-30%.</li>
                                <li>Full-year growth is expected to exceed 30% compared to 2024.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="channel-trends" class="tab-content">
                <div class="chart-container">
                    <h3>Channel Growth Trends</h3>
                    <div class="chart-wrapper">
                        <canvas id="channel-growth-chart"></canvas>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h2>Channel Trend Analysis</h2>
                    <div class="summary-content">
                        <div class="summary-card">
                            <h3>Growth Leaders</h3>
                            <ul>
                                <li><strong>Careem</strong>: Explosive growth of 368.1%, transforming from minor player to major contributor.</li>
                                <li><strong>Keeta</strong>: New entrant capturing 1.7% market share in just 10 months.</li>
                                <li><strong>NOON</strong>: Consistent growth of 47.7%, strengthening market position.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Declining Channels</h3>
                            <ul>
                                <li><strong>Talabat</strong>: Significant decline of 16.4%, losing market share to competitors.</li>
                                <li><strong>Self Delivery</strong>: Down 10.6%, indicating shift to third-party services.</li>
                                <li><strong>Talabana</strong>: Near-total collapse of 99.7%, suggesting strategic exit.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Market Shifts</h3>
                            <ul>
                                <li>Digital channels (Careem, NOON, Keeta) gained 9.2% combined market share.</li>
                                <li>Traditional delivery channels lost 4.1% market share.</li>
                                <li>Market consolidation toward digital-first platforms is evident.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="branch-trends" class="tab-content">
                <div class="chart-container">
                    <h3>Branch Performance Trends</h3>
                    <div class="chart-wrapper">
                        <canvas id="branch-trend-chart"></canvas>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h2>Branch Trend Analysis</h2>
                    <div class="summary-content">
                        <div class="summary-card">
                            <h3>Top Performers</h3>
                            <ul>
                                <li><strong>Elctria</strong>: Exceptional 169.9% growth, adding $4.8M in revenue.</li>
                                <li><strong>Al Satwa</strong>: Outstanding 81.5% growth, tripling revenue from 2024.</li>
                                <li><strong>Shabiya 11</strong>: Strong 18.3% recovery after previous decline.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Underperformers</h3>
                            <ul>
                                <li><strong>Hamdan St</strong>: Largest absolute decline (-$853K), down 10.3%.</li>
                                <li><strong>Khaldia</strong>: Slight decline of 4.0%, needs attention to prevent further erosion.</li>
                            </ul>
                        </div>
                        <div class="summary-card">
                            <h3>Market Dynamics</h3>
                            <ul>
                                <li>6 of 8 branches showed positive growth, indicating overall market health.</li>
                                <li>New branch (Al Rigga) launched successfully with $442K in first year.</li>
                                <li>Top 3 branches now represent 47.2% of total revenue (up from 44.8% in 2024).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        displayArea.innerHTML = html;
        
        // Create charts after DOM is updated
        setTimeout(() => {
            createMonthlyTrendChart();
            createChannelGrowthChart();
            createBranchTrendChart();
        }, 100);
    }

    function createChannelGrowthChart() {
        const ctx = document.getElementById('channel-growth-chart').getContext('2d');
        const channels = channelData.map(item => item.channel);
        const growth = channelData.map(item => {
            if (item.sales2024 === 0) return 100;
            return ((item.sales2025 - item.sales2024) / item.sales2024 * 100).toFixed(2);
        });
        
        const backgroundColors = growth.map(value => {
            if (value > 50) return '#4cc9f0';
            if (value > 0) return '#4cc9f0';
            if (value === 100) return '#4cc9f0';
            return '#f72585';
        });
        
        charts.channelGrowth = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: channels,
                datasets: [{
                    label: 'Growth %',
                    data: growth,
                    backgroundColor: backgroundColors,
                    borderColor: backgroundColors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Growth: ' + context.raw + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }

    function createBranchTrendChart() {
        const ctx = document.getElementById('branch-trend-chart').getContext('2d');
        const branches = branchData.map(item => item.branch);
        const sales2024 = branchData.map(item => item.sales2024);
        const sales2025 = branchData.map(item => item.sales2025);
        
        charts.branchTrend = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: branches,
                datasets: [
                    {
                        label: '2024 Sales',
                        data: sales2024,
                        backgroundColor: '#3f37c9',
                        borderColor: '#3f37c9',
                        borderWidth: 1
                    },
                    {
                        label: '2025 Sales',
                        data: sales2025,
                        backgroundColor: '#4cc9f0',
                        borderColor: '#4cc9f0',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + formatCurrency(context.raw);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value / 1000000 + 'M';
                            }
                        }
                    }
                }
            }
        });
    }

    function openTab(evt, tabName) {
        // Hide all tab content
        const tabContents = document.getElementsByClassName('tab-content');
        for (let i = 0; i < tabContents.length; i++) {
            tabContents[i].classList.remove('active');
        }
        
        // Remove active class from all tabs
        const tabs = document.getElementsByClassName('tab');
        for (let i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove('active');
        }
        
        // Show the specific tab content
        document.getElementById(tabName).classList.add('active');
        
        // Add active class to the button that opened the tab
        evt.currentTarget.classList.add('active');
    }

    function renderDetailedTable() {
        currentView = 'table';
        destroyCharts();
        
        // Clear update interval when not on dashboard
        if (updateInterval) {
            clearInterval(updateInterval);
            updateInterval = null;
        }
        
        const filteredData = getFilteredData();
        let html = `
            <h2>Detailed Sales Data</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Month</th>
                        <th>Branch</th>
                        <th>Channel</th>
                        <th>Sales 2024</th>
                        <th>Sales 2025</th>
                        <th>Orders 2024</th>
                        <th>Orders 2025</th>
                        <th>Avg Order</th>
                        <th>Growth %</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
        `;

        if (filteredData.length === 0) {
            html += `<tr><td colspan="11" style="text-align:center;">No records found matching your filters.</td></tr>`;
        } else {
            filteredData.forEach(item => {
                const avgOrder = item.orders2025 > 0 ? (item.sales2025 / item.orders2025).toFixed(1) : '0.0';
                const growth = calculateGrowth(item.sales2025, item.sales2024);
                const growthClass = getGrowthClass(growth);
                
                html += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.month}</td>
                        <td>${item.branch}</td>
                        <td>${item.channel}</td>
                        <td>${formatCurrency(item.sales2024)}</td>
                        <td>${formatCurrency(item.sales2025)}</td>
                        <td>${formatNumber(item.orders2024)}</td>
                        <td>${formatNumber(item.orders2025)}</td>
                        <td>${avgOrder}</td>
                        <td class="${growthClass}"><strong>${growth}</strong></td>
                        <td class="action-btns">
                            <a href="#" class="btn btn-primary" onclick="showEditForm(${item.id})">Edit</a>
                            <a href="#" class="btn btn-danger" onclick="handleDeleteRecord(${item.id})">Delete</a>
                        </td>
                    </tr>
                `;
            });
        }

        html += `</tbody></table>`;
        displayArea.innerHTML = html;
    }
    
    // --- CRUD (Create, Read, Update, Delete) FUNCTIONS ---
    function showAddForm() {
        addForm.reset();
        addModal.style.display = 'block';
    }

    function handleAddRecord(event) {
        event.preventDefault();
        const newRecord = {
            id: nextId++,
            month: document.getElementById('add-month').value,
            branch: document.getElementById('add-branch').value,
            channel: document.getElementById('add-channel').value,
            sales2024: parseInt(document.getElementById('add-sales-2024').value),
            sales2025: parseInt(document.getElementById('add-sales-2025').value),
            orders2024: parseInt(document.getElementById('add-orders-2024').value),
            orders2025: parseInt(document.getElementById('add-orders-2025').value),
        };
        salesData.push(newRecord);
        hideModals();
        showNotification('Record Added', 'New record has been successfully added', 'success');
        renderDetailedTable(); // Refresh the view
    }

    function showEditForm(id) {
        const record = salesData.find(item => item.id === id);
        if (!record) return;

        document.getElementById('edit-id').value = record.id;
        document.getElementById('edit-month').value = record.month;
        document.getElementById('edit-branch').value = record.branch;
        document.getElementById('edit-channel').value = record.channel;
        document.getElementById('edit-sales-2024').value = record.sales2024;
        document.getElementById('edit-sales-2025').value = record.sales2025;
        document.getElementById('edit-orders-2024').value = record.orders2024;
        document.getElementById('edit-orders-2025').value = record.orders2025;
        
        editModal.style.display = 'block';
    }

    function handleUpdateRecord(event) {
        event.preventDefault();
        const id = parseInt(document.getElementById('edit-id').value);
        const recordIndex = salesData.findIndex(item => item.id === id);

        if (recordIndex !== -1) {
            salesData[recordIndex] = {
                id: id,
                month: document.getElementById('edit-month').value,
                branch: document.getElementById('edit-branch').value,
                channel: document.getElementById('edit-channel').value,
                sales2024: parseInt(document.getElementById('edit-sales-2024').value),
                sales2025: parseInt(document.getElementById('edit-sales-2025').value),
                orders2024: parseInt(document.getElementById('edit-orders-2024').value),
                orders2025: parseInt(document.getElementById('edit-orders-2025').value),
            };
            hideModals();
            showNotification('Record Updated', 'Record has been successfully updated', 'success');
            renderDetailedTable(); // Refresh the view
        }
    }

    function handleDeleteRecord(id) {
        if (confirm('Are you sure you want to delete this record?')) {
            salesData = salesData.filter(item => item.id !== id);
            showNotification('Record Deleted', 'Record has been successfully deleted', 'danger');
            renderDetailedTable(); // Refresh the view
        }
    }

    // --- INITIALIZATION ---
    // By default, show the dashboard on load
    document.addEventListener('DOMContentLoaded', () => {
        renderDashboard();
    });

</script>

</body>
</html>
